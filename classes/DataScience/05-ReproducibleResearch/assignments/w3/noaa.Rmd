```{r}
library(data.table)

destFile <- 'stormdata.csv.bz2'
dataUrl <- 'https://d396qusza40orc.cloudfront.net/repdata/data/StormData.csv.bz2'

if (!file.exists(destFile)) {
    download.file(dataUrl, destfile=destFile, method='curl')
}

data <- as.data.table(read.csv(destFile))
setnames(data, names(data), tolower(names(data)))
nrow(data)

heat <- c('EXCESSIVE HEAT', 'HEAT', 'HEAT WAVE', 'EXTREME HEAT')
beach <- c('RIP CURRENT', 'RIP CURRENTS', 'HIGH SURF')
rain <- c('FLASH FLOOD', 'FLOOD', 'HEAVY RAIN', 'TROPICAL STORM')
storm <- c('TSTM WIND', 'HIGH WIND', 'THUNDERSTORM WIND', 'STRONG WIND',
           'HURRICANE/TYPHOON', 'THUNDERSTORM WINDS')

sizeFactor <- 0.01
tornadoData <- data[evtype=='TORNADO',
                    .(fatalities, injuries, lat=latitude/100, lon=longitude/100,
                      siz=sizeFactor*fatalities)
                    ][order(-fatalities, -injuries)
                    ][1:100,.(lat, lon, siz)]
heatData <- data[evtype %in% heat,
                 .(fatalities, injuries, county=countyname, state,
                   lat=latitude/100, lon=-1*longitude/100,
                   siz=sizeFactor*fatalities)
                 ][order(-fatalities, -injuries)
                 ][1:100,.(lat, lon, siz, county, state)]
rainData <- data[evtype %in% rain,
                 .(fatalities, injuries, lat=latitude/100, lon=-1*longitude/100,
                   siz=sizeFactor*fatalities, county=countyname, state)
                 ][order(-fatalities, -injuries)
                 ][1:100,.(lat, lon, siz, county, state)]


map(database= "world", ylim=c(45,90), xlim=c(-160,-50), col="grey80",
    fill=TRUE, projection="gilbert", orientation= c(90,0,225))
tornadoCoord <- mapproject(tornadoData$lon, tornadoData$lat, proj="gilbert",
                           orientation=c(90, 0, 225))
points(coord, pch=20, cex=tornadoData$siz, col="red")
```
